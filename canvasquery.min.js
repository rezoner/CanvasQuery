/*     
  Canvas Query 0.8.4 work in progress
  http://canvasquery.org
  (c) 2012-2013 http://rezoner.net
  Canvas Query may be freely distributed under the MIT license.
*/

(function(n,v){var y=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent);n.requestAnimationFrame=n.requestAnimationFrame||n.webkitRequestAnimationFrame||n.mozRequestAnimationFrame||n.oRequestAnimationFrame||n.msRequestAnimationFrame||function(a){n.setTimeout(a,1E3/60)};var g=function(a){if(0===arguments.length){var c=g.createCanvas(n.innerWidth,n.innerHeight);n.addEventListener("resize",function(){})}else if("string"===typeof a)c=document.querySelector(a);else if("number"===typeof a)c=
g.createCanvas(arguments[0],arguments[1]);else if(a instanceof Image||a instanceof HTMLImageElement)c=g.createCanvas(a);else{if(a instanceof g.Wrapper)return a;c=a}return new g.Wrapper(c)};g.extend=function(){for(var a=1;a<arguments.length;a++)for(var c in arguments[a])arguments[0][c]=arguments[a][c];return arguments[0]};g.augment=function(){for(var a=1;a<arguments.length;a++)_.extend(arguments[0],arguments[a]),arguments[a](arguments[0])};g.distance=function(a,c,b,d){if(2<arguments.length){var f=
a-b,e=c-d;return Math.sqrt(f*f+e*e)}return Math.abs(a-c)};g.extend(g,{keycodes:{37:"left",38:"up",39:"right",40:"down",45:"insert",46:"delete",8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"escape",32:"space",33:"pageup",34:"pagedown",35:"end",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:"semicolon",187:"equal",188:"comma",189:"dash",190:"period",191:"slash",
192:"graveaccent",219:"openbracket",220:"backslash",221:"closebraket",222:"singlequote"},cleanArray:function(a,c){for(var b=arguments[arguments.length-1],d="function"===typeof b,f=0,e=a.length;f<e;f++)if(null===a[f]||c&&a[f][c])d&&b(a[f]),a.splice(f--,1),e--},specialBlendFunctions:["color","value","hue","saturation"],blendFunctions:{normal:function(a,c){return c},overlay:function(a,c){a/=255;c/=255;return Math.min(255,Math.max(0,255*(0.5>a?2*a*c:1-2*(1-a)*(1-c))|0))},hardLight:function(a,c){return g.blendFunctions.overlay(c,
a)},softLight:function(a,c){a/=255;c/=255;return g.limitValue(255*((1-2*c)*a*a+2*c*a),0,255)},dodge:function(a,c){return Math.min(256*a/(255-c+1),255)},burn:function(a,c){return 255-Math.min(256*(255-a)/(c+1),255)},multiply:function(a,c){return c*a/255},divide:function(a,c){return Math.min(256*a/(c+1),255)},screen:function(a,c){return 255-(255-c)*(255-a)/255},grainExtract:function(a,c){return g.limitValue(a-c+128,0,255)},grainMerge:function(a,c){return g.limitValue(a+c-128,0,255)},difference:function(a,
c){return Math.abs(a-c)},addition:function(a,c){return Math.min(a+c,255)},substract:function(a,c){return Math.max(a-c,0)},darkenOnly:function(a,c){return Math.min(a,c)},lightenOnly:function(a,c){return Math.max(a,c)},color:function(a,c){var b=g.rgbToHsl(a),d=g.rgbToHsl(c);return g.hslToRgb(d[0],d[1],b[2])},hue:function(a,c){var b=g.rgbToHsv(a),d=g.rgbToHsv(c);return d[1]?g.hsvToRgb(d[0],b[1],b[2]):g.hsvToRgb(b[0],b[1],b[2])},value:function(a,c){var b=g.rgbToHsv(a),d=g.rgbToHsv(c);return g.hsvToRgb(b[0],
b[1],d[2])},saturation:function(a,c){var b=g.rgbToHsv(a),d=g.rgbToHsv(c);return g.hsvToRgb(b[0],d[1],b[2])}},blend:function(a,c,b,d){"undefined"===typeof d&&(d=1);a=g(a);c=g(c);var f=c.context,e=a.context.getImageData(0,0,a.canvas.width,a.canvas.height);c=f.getImageData(0,0,c.canvas.width,c.canvas.height);e=e.data;c=c.data;var f=this.createImageData(a.canvas.width,a.canvas.height),h=f.data,k=g.blendFunctions[b];if(-1!==g.specialBlendFunctions.indexOf(b)){b=0;for(var j=e.length;b<j;b+=4){var l=k([e[b+
0],e[b+1],e[b+2]],[c[b+0],c[b+1],c[b+2]]);h[b+0]=e[b+0]+(l[0]-e[b+0])*d;h[b+1]=e[b+1]+(l[1]-e[b+1])*d;h[b+2]=e[b+2]+(l[2]-e[b+2])*d;h[b+3]=e[b+3]}}else{b=0;for(j=e.length;b<j;b+=4){var l=k(e[b+0],c[b+0]),m=k(e[b+1],c[b+1]),p=k(e[b+2],c[b+2]);h[b+0]=e[b+0]+(l-e[b+0])*d;h[b+1]=e[b+1]+(m-e[b+1])*d;h[b+2]=e[b+2]+(p-e[b+2])*d;h[b+3]=e[b+3]}}a.context.putImageData(f,0,0);return a},wrapValue:function(a,c,b){b=Math.abs(b-c);return c+(a-c)%b},limitValue:function(a,c,b){return a<c?c:a>b?b:a},mix:function(a,
c,b){return a+(c-a)*b},hexToRgb:function(a){return 7===a.length?["0x"+a[1]+a[2]|0,"0x"+a[3]+a[4]|0,"0x"+a[5]+a[6]|0]:["0x"+a[1]|0,"0x"+a[2],"0x"+a[3]|0]},rgbToHex:function(a,c,b){return"#"+(16777216+(a<<16)+(c<<8)+b).toString(16).slice(1,7)},rgbToHsl:function(a,c,b){a instanceof Array&&(b=a[2],c=a[1],a=a[0]);a/=255;c/=255;b/=255;var d=Math.max(a,c,b),f=Math.min(a,c,b),e,h=(d+f)/2;if(d==f)e=f=0;else{var g=d-f,f=0.5<h?g/(2-d-f):g/(d+f);switch(d){case a:e=(c-b)/g+(c<b?6:0);break;case c:e=(b-a)/g+2;break;
case b:e=(a-c)/g+4}e/=6}return[e,f,h]},hslToRgb:function(a,c,b){if(0==c)b=c=a=b;else{var d=function(a,b,c){0>c&&(c+=1);1<c&&(c-=1);return c<1/6?a+6*(b-a)*c:0.5>c?b:c<2/3?a+6*(b-a)*(2/3-c):a},f=0.5>b?b*(1+c):b+c-b*c,e=2*b-f;b=d(e,f,a+1/3);c=d(e,f,a);a=d(e,f,a-1/3)}return[255*b|0,255*c|0,255*a|0]},rgbToHsv:function(a,c,b){a instanceof Array&&(b=a[2],c=a[1],a=a[0]);a/=255;c/=255;b/=255;var d=Math.max(a,c,b),f=Math.min(a,c,b),e,h=d-f;if(d==f)e=0;else{switch(d){case a:e=(c-b)/h+(c<b?6:0);break;case c:e=
(b-a)/h+2;break;case b:e=(a-c)/h+4}e/=6}return[e,0==d?0:h/d,d]},hsvToRgb:function(a,c,b){var d,f,e,h=Math.floor(6*a),g=6*a-h;a=b*(1-c);var j=b*(1-g*c);c=b*(1-(1-g)*c);switch(h%6){case 0:d=b;f=c;e=a;break;case 1:d=j;f=b;e=a;break;case 2:d=a;f=b;e=c;break;case 3:d=a;f=j;e=b;break;case 4:d=c;f=a;e=b;break;case 5:d=b,f=a,e=j}return[255*d|0,255*f|0,255*e|0]},color:function(a,c){var b=new g.Color;b.parse(a,c);return b},createCanvas:function(a,c){var b=document.createElement("canvas");a instanceof Image||
a instanceof HTMLImageElement?(b.width=a.width,b.height=a.height,b.getContext("2d").drawImage(a,0,0)):(b.width=a,b.height=c);return b},createImageData:function(a,c){return document.createElement("Canvas").getContext("2d").createImageData(a,c)},mousePosition:function(a){var c=0,b=0,d=a.target||a.srcElement,f=0,e=0;do c+=d.offsetLeft,b+=d.offsetTop;while(d=d.offsetParent);a.changedTouches&&a.changedTouches[0]!==v&&(a=a.changedTouches[0]);if(a.pageX||a.pageY)f=a.pageX,e=a.pageY;else if(a.clientX||a.clientY)f=
a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;return{x:f-c,y:e-b}}});g.Wrapper=function(a){this.context=a.getContext("2d");this.canvas=a};g.Wrapper.prototype={appendTo:function(a){("object"===typeof a?a:document.querySelector(a)).appendChild(this.canvas);return this},blendOn:function(a,c,b){g.blend(a,this,c,b);return this},blend:function(a,c,b){if("string"===typeof a){var d=a;a=g(g.createCanvas(this.canvas.width,
this.canvas.height));a.fillStyle(d).fillRect(0,0,this.canvas.width,this.canvas.height)}g.blend(this,a,c,b);return this},circle:function(a,c,b){this.context.beginPath();this.context.arc(a,c,b,0,2*Math.PI);return this},crop:function(a,c,b,d){var f=g.createCanvas(b,d);f.getContext("2d").drawImage(this.canvas,a,c,b,d,0,0,b,d);this.canvas.width=b;this.canvas.height=d;this.clear();this.context.drawImage(f,0,0);return this},set:function(a){g.extend(this.context,a)},resize:function(a,c){var b=a,d=c;1===arguments.length?(b=arguments[0]*
this.canvas.width|0,d=arguments[0]*this.canvas.height|0):null===c?this.canvas.width>a?(d=this.canvas.height*(a/this.canvas.width)|0,b=a):(b=this.canvas.width,d=this.canvas.height):null===a&&(this.canvas.width>a?(b=this.canvas.width*(c/this.canvas.height)|0,d=c):(b=this.canvas.width,d=this.canvas.height));b=g(b,d).drawImage(this.canvas,0,0,this.canvas.width,this.canvas.height,0,0,b,d);this.canvas=b.canvas;this.context=b.context;return this},trim:function(a,c){var b;a?(a=g.color(a).toArray(),b=!a[3]):
b=!0;for(var d=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,f=[this.canvas.width,this.canvas.height,0,0],e=0,h=d.length;e<h;e+=4){if(b){if(!d[e+3])continue}else if(d[e+0]===a[0]&&d[e+1]===a[1]&&d[e+2]===a[2])continue;var k=(e/4|0)%this.canvas.width|0,j=(e/4|0)/this.canvas.width|0;k<f[0]&&(f[0]=k);k>f[2]&&(f[2]=k);j<f[1]&&(f[1]=j);j>f[3]&&(f[3]=j)}0===f[2]||0===f[3]||(c&&(c.left=f[0],c.top=f[1],c.width=f[2]-f[0],c.height=f[3]-f[1]),this.crop(f[0],f[1],f[2]-f[0]+1,f[3]-f[1]+
1));return this},resizePixel:function(a){var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,b=document.createElement("canvas"),d=b.context=b.getContext("2d");b.width=this.canvas.width*a|0;b.height=this.canvas.height*a|0;for(var f=0,e=c.length;f<e;f+=4)c[f+3]&&(d.fillStyle=g.rgbToHex(c[f+0],c[f+1],c[f+2]),d.fillRect(f/4%this.canvas.width*a,(f/4/this.canvas.width|0)*a,a,a));this.canvas.width=b.width;this.canvas.height=b.height;this.clear().drawImage(b,0,0);return this},matchPalette:function(a){for(var c=
this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=[],d=0;d<a.length;d++)b.push(g.color(a[d]));for(d=0;d<c.data.length;d+=4){for(var f=[],e=0;e<b.length;e++){var h=b[e],k=Math.abs(c.data[d]-h[0]),j=Math.abs(c.data[d+1]-h[1]),h=Math.abs(c.data[d+2]-h[2]);f.push(k+j+h)}for(e=k=0;e<a.length;e++)f[e]<f[k]&&(k=e);f=cq.hexToRgb(a[k]);c.data[d]=f[0];c.data[d+1]=f[1];c.data[d+2]=f[2]}this.context.putImageData(c,0,0);return this},getPalette:function(){for(var a=[],c=this.context.getImageData(0,
0,this.canvas.width,this.canvas.height).data,b=0,d=c.length;b<d;b+=4)if(c[b+3]){var f=g.rgbToHex(c[b+0],c[b+1],c[b+2]);-1===a.indexOf(f)&&a.push(f)}return a},pixelize:function(a){if(!a)return this;var c=this.context.mozImageSmoothingEnabled,b=this.context.webkitImageSmoothingEnabled;this.context.mozImageSmoothingEnabled=!1;this.context.webkitImageSmoothingEnabled=!1;a=this.canvas.width/(a||4)/this.canvas.width;var d=cq(this.canvas.width,this.canvas.height);d.drawImage(this.canvas,0,0,this.canvas.width,
this.canvas.height,0,0,this.canvas.width*a|0,this.canvas.height*a|0);this.clear().drawImage(d.canvas,0,0,this.canvas.width*a|0,this.canvas.height*a|0,0,0,this.canvas.width,this.canvas.height);this.context.mozImageSmoothingEnabled=c;this.context.webkitImageSmoothingEnabled=b;return this},colorToMask:function(a,c){a=g.color(a).toArray();for(var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data,d=[],f=0,e=b.length;f<e;f+=4)b[f+0]==a[0]&&b[f+1]==a[1]&&b[f+2]==a[2]?d.push(c||!1):
d.push(!c);return d},grayscaleToMask:function(a){g.color(a).toArray();a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height).data;for(var c=[],b=0,d=a.length;b<d;b+=4)c.push((a[b+0]+a[b+1]+a[b+2])/3|0);return c},grayscaleToAlpha:function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=a.data,b=0,d=c.length;b<d;b+=4)c[b+3]=(c[b+0]+c[b+1]+c[b+2])/3|0,c[b+0]=c[b+1]=c[b+2]=255;this.context.putImageData(a,0,0);return this},applyMask:function(a){for(var c=
this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=c.data,d="boolean"===typeof a[0]?"bool":"byte",f=0,e=b.length;f<e;f+=4){var h=a[f/4];b[f+3]="bool"===d?255*h|0:h|0}this.context.putImageData(c,0,0);return this},fillMask:function(a){var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=c.data,d="boolean"===typeof a[0]?"bool":"byte",f=2===arguments.length?"normal":"gradient",e=g.color(arguments[1]);"gradient"===f&&(colorB=g.color(arguments[2]));for(var h=0,
k=b.length;h<k;h+=4){var j=a[h/4];"byte"===d&&(j/=255);"normal"===f?j&&(b[h+0]=e[0]|0,b[h+1]=e[1]|0,b[h+2]=e[2]|0,b[h+3]=255*j|0):(b[h+0]=e[0]+(colorB[0]-e[0])*j|0,b[h+1]=e[1]+(colorB[1]-e[1])*j|0,b[h+2]=e[2]+(colorB[2]-e[2])*j|0,b[h+3]=255)}this.context.putImageData(c,0,0);return this},clear:function(a){a?(this.context.fillStyle=a,this.context.fillRect(0,0,this.canvas.width,this.canvas.height)):this.context.clearRect(0,0,this.canvas.width,this.canvas.height);return this},clone:function(){var a=g.createCanvas(this.canvas.width,
this.canvas.height);a.getContext("2d").drawImage(this.canvas,0,0);return g(a)},fillStyle:function(a){this.context.fillStyle=a;return this},strokeStyle:function(a){this.context.strokeStyle=a;return this},gradientText:function(a,c,b,d,f){var e=a.split(" "),h=2*this.font().match(/\d+/g)[0],g=0,j=0;if(d)for(var j=0,l=[""],m=0;m<e.length;m++){a=e[m]+" ";var p=this.context.measureText(a).width;g+p>d&&(l[++j]="",g=0);l[j]+=a;g+=p}else l=[a];for(m=0;m<l.length;m++){j=b+0.6*m*h|0;d=this.context.createLinearGradient(0,
j,0,j+0.6*h|0);for(e=0;e<f.length;e+=2)d.addColorStop(f[e],f[e+1]);a=l[m];this.fillStyle(d).fillText(a,c,j)}return this},setHsl:function(){var a=1===arguments.length?arguments[0]:arguments,c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=c.data,d,f,e;e=[];d=[];for(var h=0,k=b.length;h<k;h+=4)e=g.rgbToHsl(b[h+0],b[h+1],b[h+2]),d=null===a[0]?e[0]:g.limitValue(a[0],0,1),f=null===a[1]?e[1]:g.limitValue(a[1],0,1),e=null===a[2]?e[2]:g.limitValue(a[2],0,1),d=g.hslToRgb(d,f,e),b[h+
0]=d[0],b[h+1]=d[1],b[h+2]=d[2];this.context.putImageData(c,0,0);return this},shiftHsl:function(){var a=1===arguments.length?arguments[0]:arguments,c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=c.data,d,f,e;e=[];d=[];for(var h=0,k=b.length;h<k;h+=4)e=g.rgbToHsl(b[h+0],b[h+1],b[h+2]),d=null===a[0]?e[0]:g.wrapValue(e[0]+a[0],0,1),f=null===a[1]?e[1]:g.limitValue(e[1]+a[1],0,1),e=null===a[2]?e[2]:g.limitValue(e[2]+a[2],0,1),d=g.hslToRgb(d,f,e),b[h+0]=d[0],b[h+1]=d[1],b[h+2]=
d[2];this.context.putImageData(c,0,0);return this},replaceHue:function(a,c){var b=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),d=b.data,f,e=[];f=[];for(var h=0,k=d.length;h<k;h+=4)e=g.rgbToHsl(d[h+0],d[h+1],d[h+2]),f=0.05>Math.abs(e[0]-a)?g.wrapValue(c,0,1):e[0],f=g.hslToRgb(f,e[1],e[2]),d[h+0]=f[0],d[h+1]=f[1],d[h+2]=f[2];this.context.putImageData(b,0,0);return this},invert:function(){for(var a=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),c=a.data,b=
0,d=c.length;b<d;b+=4)c[b+0]=255-c[b+0],c[b+1]=255-c[b+1],c[b+2]=255-c[b+2];this.context.putImageData(a,0,0);return this},roundRect:function(a,c,b,d,f){this.beginPath();this.moveTo(a+f,c);this.lineTo(a+b-f,c);this.quadraticCurveTo(a+b,c,a+b,c+f);this.lineTo(a+b,c+d-f);this.quadraticCurveTo(a+b,c+d,a+b-f,c+d);this.lineTo(a+f,c+d);this.quadraticCurveTo(a,c+d,a,c+d-f);this.lineTo(a,c+f);this.quadraticCurveTo(a,c,a+f,c);this.closePath();return this},wrappedText:function(a,c,b,d,f){var e=a.split(" "),
h=2*this.font().match(/\d+/g)[0],g=0,j=0;if(d){a=0;for(var l=[""],m=0;m<e.length;m++){var j=e[m]+" ",p=this.context.measureText(j).width;g+p>d&&(l[++a]="",g=0);l[a]+=j;g+=p}}else l=[a];for(m=0;m<l.length;m++)j=b+0.6*m*h|0,a=l[m],f&&f.call(this,c,b+j),this.fillText(a,c,j);return this},textBoundaries:function(a,c){var b=a.split(" "),d=2*this.font().match(/\d+/g)[0],f=0;if(c)for(var e=0,h=[""],g=0;g<b.length;g++){var j=b[g]+" ",l=this.context.measureText(j).width;f+l>c&&(h[++e]="",f=0);h[e]+=j;f+=l}else h=
[a],c=this.measureText(a).width;return{height:0.6*h.length*d|0,width:c}},paperBag:function(a,c,b,d,f,e){this.beginPath();this.moveTo(a,c);this.quadraticCurveTo(a+b/2|0,c+d*e|0,a+b,c);this.quadraticCurveTo(a+b-b*f|0,c+d/2|0,a+b,c+d);this.quadraticCurveTo(a+b/2|0,c+d-d*e|0,a,c+d);this.quadraticCurveTo(a+b*f|0,c+d/2|0,a,c)},borderImage:function(a,c,b,d,f,e,g,k,j,l){this.drawImage(a,j,0,a.width-j-g,e,c+j,b,d-j-g,e);this.drawImage(a,j,a.height-k,a.width-j-g,k,c+j,b+f-k,d-j-g,k);this.drawImage(a,0,e,j,
a.height-k-e,c,b+e,j,f-k-e);this.drawImage(a,a.width-g,e,g,a.height-k-e,c+d-g,b+e,g,f-k-e);this.drawImage(a,0,0,j,e,c,b,j,e);this.drawImage(a,a.width-g,0,g,e,c+d-g,b,g,e);this.drawImage(a,a.width-g,a.height-k,g,k,c+d-g,b+f-k,g,k);this.drawImage(a,0,a.height-k,j,k,c,b+f-k,j,k);l&&("string"===typeof l?this.fillStyle(l).fillRect(c+j,b+e,d-j-g,f-e-k):this.drawImage(a,j,e,a.width-g-j,a.height-k-e,c+j,b+e,d-j-g,f-e-k))},convolve:function(a,c,b){"undefined"===typeof b&&(b=1);"undefined"===typeof c&&(c=1);
for(var d=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),f=Math.sqrt(a.length)+0.5|0,e=f/2|0,h=d.data,k=d.width,d=d.height,j=g.createImageData(this.canvas.width,this.canvas.height).data,l=1;l<d-1;l++)for(var m=1;m<k-1;m++){for(var p=4*(l*k+m),n=0,z=0,q=0,r=0,w=0;w<f;w++)for(var x=0;x<f;x++){var s=l+w-e,t=m+x-e;0<=s&&(s<d&&0<=t&&t<k)&&(s=4*(s*k+t),t=a[w*f+x]/b,n+=h[s+0]*t,z+=h[s+1]*t,q+=h[s+2]*t,r+=h[s+3]*t)}j[p+0]=g.mix(h[p+0],n,c);j[p+1]=g.mix(h[p+1],z,c);j[p+2]=g.mix(h[p+2],
q,c);j[p+3]=r}},blur:function(a){return this.convolve([1,1,1,1,1,1,1,1,1],a,9)},gaussianBlur:function(a){return this.convolve([6.7E-7,2.292E-5,1.9117E-4,3.8771E-4,1.9117E-4,2.292E-5,6.7E-7,2.292E-5,7.8633E-4,0.00655965,0.01330373,0.00655965,7.8633E-4,2.292E-5,1.9117E-4,0.00655965,0.05472157,0.11098164,0.05472157,0.00655965,1.9117E-4,3.8771E-4,0.01330373,0.11098164,0.22508352,0.11098164,0.01330373,3.8771E-4,1.9117E-4,0.00655965,0.05472157,0.11098164,0.05472157,0.00655965,1.9117E-4,2.292E-5,7.8633E-4,
0.00655965,0.01330373,0.00655965,7.8633E-4,2.292E-5,6.7E-7,2.292E-5,1.9117E-4,3.8771E-4,1.9117E-4,2.292E-5,6.7E-7],a,1)},sharpen:function(a){return this.convolve([0,-1,0,-1,5,-1,0,-1,0],a)},threshold:function(a){for(var c=this.context.getImageData(0,0,this.canvas.width,this.canvas.height),b=c.data,d,f,e,g=0;g<b.length;g+=4)d=b[g],f=b[g+1],e=b[g+2],b[g]=b[g+1]=b[g+2]=0.2126*d+0.7152*f+0.0722*e>=a?255:0;this.context.putImageData(c,0,0);return this},sepia:function(){for(var a=this.context.getImageData(0,
0,this.canvas.width,this.canvas.height),c=a.data,b=0;b<c.length;b+=4)c[b+0]=g.limitValue(0.393*c[b+0]+0.769*c[b+1]+0.189*c[b+2],0,255),c[b+1]=g.limitValue(0.349*c[b+0]+0.686*c[b+1]+0.168*c[b+2],0,255),c[b+2]=g.limitValue(0.272*c[b+0]+0.534*c[b+1]+0.131*c[b+2],0,255);this.context.putImageData(a,0,0);return this},measureText:function(){return this.context.measureText.apply(this.context,arguments)},createRadialGradient:function(){return this.context.createRadialGradient.apply(this.context,arguments)},
createLinearGradient:function(){return this.context.createLinearGradient.apply(this.context,arguments)},getImageData:function(){return this.context.getImageData.apply(this.context,arguments)},framework:function(a,c){c&&(this.tempContext=!0===c?a:c);for(var b in a)if(this[b])this[b](a[b],v,v);this.tempContext=null;return this},onStep:function(a,c){var b=this.tempContext||this,d=Date.now();this.timer=setInterval(function(){var c=Date.now()-d;d=Date.now();a.call(b,c,d)},c||25);return this},onRender:function(a){function c(){var f=
Date.now()-d;d=Date.now();requestAnimationFrame(c);a.call(b,f,d)}var b=this.tempContext||this,d=Date.now();requestAnimationFrame(c);return this},onMouseMove:function(a){var c=this.tempContext||this;y?this.canvas.addEventListener("touchmove",function(b){b.preventDefault();b=g.mousePosition(b);a.call(c,b.x,b.y)}):this.canvas.addEventListener("mousemove",function(b){b=g.mousePosition(b);a.call(c,b.x,b.y)});return this},onMouseDown:function(a){var c=this.tempContext||this;y?this.canvas.addEventListener("touchstart",
function(b){var d=g.mousePosition(b);a.call(c,d.x,d.y,b.button)}):this.canvas.addEventListener("mousedown",function(b){var d=g.mousePosition(b);a.call(c,d.x,d.y,b.button)});return this},onMouseUp:function(a){var c=this.tempContext||this;y?this.canvas.addEventListener("touchend",function(b){var d=g.mousePosition(b);a.call(c,d.x,d.y,b.button)}):this.canvas.addEventListener("mouseup",function(b){var d=g.mousePosition(b);a.call(c,d.x,d.y,b.button)});return this},onSwipe:function(a,c,b){function d(a){a.preventDefault();
l=g.mousePosition(a);m=Date.now()}function f(a){a.preventDefault();n=g.mousePosition(a);q=Date.now()}function e(b){b.preventDefault();b=l.x-n.x;var c=l.y-n.y,d=Math.sqrt(b*b+c*c),e=q-m,f=v;d>k&&e<j&&(f=Math.abs(b)>Math.abs(c)?0<b?"left":"right":0<c?"up":"down",a.call(h,f))}var h=this.tempContext||this,k=c||35,j=b||350,l=0,m=0,n=0,q=0;this.canvas.addEventListener("touchstart",function(a){d(a)});this.canvas.addEventListener("touchmove",function(a){f(a)});this.canvas.addEventListener("touchend",function(a){e(a)});
this.canvas.addEventListener("mousedown",function(a){d(a)});this.canvas.addEventListener("mousemove",function(a){f(a)});this.canvas.addEventListener("mouseup",function(a){e(a)});return this},onKeyDown:function(a){var c=this.tempContext||this;document.addEventListener("keydown",function(b){b=48<=b.which&&90>=b.which?String.fromCharCode(b.which).toLowerCase():g.keycodes[b.which];a.call(c,b)});return this},onKeyUp:function(a){var c=this.tempContext||this;document.addEventListener("keyup",function(b){b=
48<=b.which&&90>=b.which?String.fromCharCode(b.which).toLowerCase():g.keycodes[b.which];a.call(c,b)});return this},onResize:function(a){var c=this.tempContext||this;n.addEventListener("resize",function(){a.call(c,n.innerWidth,n.innerHeight)});a.call(c,n.innerWidth,n.innerHeight);return this},onDropImage:function(a){var c=this.tempContext||this;document.addEventListener("drop",function(b){b.stopPropagation();b.preventDefault();b=b.dataTransfer.files[0];if(!/image/i.test(b.type))return!1;var d=new FileReader;
d.onload=function(b){var d=new Image;d.onload=function(){a.call(c,this)};d.src=b.target.result};d.readAsDataURL(b)});document.addEventListener("dragover",function(a){a.preventDefault()});return this}};for(var u="arc arcTo beginPath bezierCurveTo clearRect clip closePath createImageData createLinearGradient createRadialGradient createPattern drawFocusRing drawImage fill fillRect fillText getImageData isPointInPath lineTo measureText moveTo putImageData quadraticCurveTo rect restore rotate save scale setTransform stroke strokeRect strokeText transform translate".split(" "),
r=0;r<u.length;r++){var q=u[r];g.Wrapper.prototype[q]||(g.Wrapper.prototype[q]=Function("this.context."+q+".apply(this.context, arguments); return this;"))}u="canvas fillStyle font globalAlpha globalCompositeOperation lineCap lineJoin lineWidth miterLimit shadowOffsetX shadowOffsetY shadowBlur shadowColor strokeStyle textAlign textBaseline".split(" ");for(r=0;r<u.length;r++)q=u[r],g.Wrapper.prototype[q]||(g.Wrapper.prototype[q]=Function("if(arguments.length) { this.context."+q+" = arguments[0]; return this; } else { return this.context."+
q+"; }"));g.Color=function(a,c){arguments.length&&this.parse(a)};g.Color.prototype={parse:function(a,c){if(a[0]instanceof g.Color)this[0]=a[0][0],this[1]=a[0][1],this[2]=a[0][2],this[3]=a[0][3];else if("string"===typeof a){var b=null;"#"===a[0]?(b=g.hexToRgb(a),this[0]=b[0],this[1]=b[1],this[2]=b[2],this[3]=1):(b=a.match(/rgb\((.*),(.*),(.*)\)/))?(this[0]=b[1]|0,this[1]=b[2]|0,this[2]=b[3]|0,this[3]=1):(b=a.match(/rgba\((.*),(.*),(.*)\)/))?(this[0]=b[1]|0,this[1]=b[2]|0,this[2]=b[3]|0,this[3]=b[4]|
0):(b=a.match(/hsl\((.*),(.*),(.*)\)/))?this.fromHsl(b[1],b[2],b[3]):(b=a.match(/hsv\((.*),(.*),(.*)\)/))&&this.fromHsv(b[1],b[2],b[3])}else switch(c){case "hsl":case "hsla":this.fromHsl(a[0],a[1],a[2],a[3]);break;case "hsv":case "hsva":this.fromHsv(a[0],a[1],a[2],a[3]);break;default:this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]="undefined"===typeof a[3]?1:a[3]}},fromHsl:function(){var a=arguments[0]instanceof Array?arguments[0]:arguments,a=g.hslToRgb(a[0],a[1],a[2]);this[0]=a[0];this[1]=a[1];this[2]=
a[2];this[3]="undefined"===typeof arguments[3]?1:arguments[3]},fromHsv:function(){var a=arguments[0]instanceof Array?arguments[0]:arguments,a=g.hsvToRgb(a[0],a[1],a[2]);this[0]=a[0];this[1]=a[1];this[2]=a[2];this[3]="undefined"===typeof arguments[3]?1:arguments[3]},toArray:function(){return[this[0],this[1],this[2],this[3]]},toRgb:function(){return"rgb("+this[0]+", "+this[1]+", "+this[2]+")"},toRgba:function(){return"rgba("+this[0]+", "+this[1]+", "+this[2]+", "+this[3]+")"},toHex:function(){return g.rgbToHex(this[0],
this[1],this[2])},toHsl:function(){var a=g.rgbToHsl(this[0],this[1],this[2]);a[3]=this[3];return a},toHsv:function(){var a=g.rgbToHsv(this[0],this[1],this[2]);a[3]=this[3];return a},gradient:function(a){g.color(a)},shiftHsl:function(a,c,b){var d=this.toHsl();a=null===a?d[0]:g.wrapValue(d[0]+a,0,1);c=null===c?d[1]:g.limitValue(d[1]+c,0,1);b=null===b?d[2]:g.limitValue(d[2]+b,0,1);this.fromHsl(a,c,b);return this},setHsl:function(a,c,b){var d=this.toHsl();a=null===a?d[0]:g.limitValue(a,0,1);c=null===
c?d[1]:g.limitValue(c,0,1);b=null===b?d[2]:g.limitValue(b,0,1);this.fromHsl(a,c,b);return this}};n.cq=n.CanvasQuery=g;"function"===typeof define&&define.amd&&define([],function(){return g})})(window);
